{"version":3,"sources":["library-dist.js"],"names":[],"mappings":"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","file":"library-dist.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('bluebird'), require('path'), require('fs-promise'), require('temp'), require('dot'), require('child_process'), require('jsonfile'), require('asar')) :\n\ttypeof define === 'function' && define.amd ? define(['bluebird', 'path', 'fs-promise', 'temp', 'dot', 'child_process', 'jsonfile', 'asar'], factory) :\n\tglobal.MyLibrary = factory(global.bluebird, global.path, global.fs, global.temp, global.dot, global.ChildProcess, global.jf, global.asar)\n}(this, function (bluebird, path, fs, temp, dot, ChildProcess, jf, asar) { 'use strict';\n\n\t'use strict';\n\n\tvar Util = {\n\t\tisEmpty(str) {\n\t    return (!str || str.length === 0);\n\t\t},\n\t  exec(cmd, args, options) {\n\t    return new bluebird((resolve, reject) => {\n\t      ChildProcess.execFile(cmd, args, options, (error, stdout, stderr) => {\n\t        if(error) {\n\t          reject(new Error(`Command\\n${cmd} ${args}\\n returned non-zero code ${error} with error output ${stderr}`));\n\t        } else {\n\t          resolve(stdout);\n\t        }\n\t      });\n\t    });\n\t  },\n\t  getPackageJson(appDirectory) {\n\t    try {\n\t      return jf.readFileSync(path.resolve(appDirectory, 'resources', 'app', 'package.json'));\n\t    } catch (error) {\n\t      try {\n\t        return JSON.parse(asar.extractFile(path.resolve(appDirectory, 'resources', 'app.asar'), 'package.json'));\n\t      } catch (error) {\n\t        throw new Error('Neither resources/app folder nor resources/app.asar package were found.');\n\t      }\n\t    }\n\t  }\n\t}\n\n\t'use strict';\n\n\tclass InstallerFactory {\n\t\tconstructor({\n\t\t\tappDirectory,\n\t\t\toutputDirectory = 'installer',\n\t\t\tloadingGif = path.resolve(__dirname, '..', 'resources', 'install-spinner.gif'),\n\t\t\tauthors,\n\t\t\towners,\n\t\t\texe,\n\t\t\ticonUrl = 'https://raw.githubusercontent.com/atom/atom-shell/master/atom/browser/resources/win/atom.ico',\n\t\t\tdescription,\n\t\t\tversion,\n\t\t\ttitle,\n\t\t\tcertificateFile,\n\t\t\tcertificatePassword,\n\t\t\tsignWithParams,\n\t\t\tsetupIcon,\n\t\t\tremoteReleases\n\t\t} = {}) {\n\t\t\tif(Util.isEmpty(appDirectory)) {\n\t\t\t\tthrow new Error('Please provide \"appDirectory\" config parameter.');\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst appMetadata = Util.getPackageJson(appDirectory);\n\t\t\t\tthis.appDirectory = appDirectory;\n\t\t\t\tthis.outputDirectory = path.resolve(outputDirectory);\n\t\t\t\tthis.loadingGif = path.resolve(loadingGif);\n\t\t\t\tthis.authors = authors || appMetadata.author || '';\n\t\t\t\tthis.owners = owners || this.authors;\n\t\t\t\tthis.name = appMetadata.name;\n\t\t\t\tthis.exe = exe || this.name;\n\t\t\t\tthis.iconUrl = iconUrl;\n\t\t\t\tthis.description = description || appMetadata.description;\n\t\t\t\tthis.version = version || appMetadata.version;\n\t\t\t\tthis.productName = appMetadata.productName || this.name;\n\t\t\t\tthis.title = title || this.productName || this.name;\n\t\t\t\tthis.certificateFile = certificateFile;\n\t\t\t\tthis.certificatePassword = certificatePassword;\n\t\t\t\tthis.signWithParams = signWithParams;\n\t\t\t\tthis.setupIcon = setupIcon;\n\t\t\t\tthis.remoteReleases = remoteReleases;\n\t\t\t} catch (error) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t\tsyncReleases() {\n\t\t\tif(this.remoteReleases) {\n\t\t\t\tconst cmd = path.resolve(__dirname, '..', 'vendor', 'SyncReleases.exe');\n\t\t\t\tconst args = ['-u', this.remoteReleases, '-r', this.outputDirectory];\n\t\t\t\treturn Util.exec(cmd, args);\n\t\t\t} else {\n\t\t\t\treturn bluebird.resolve();\n\t\t\t}\n\t\t}\n\t\tupdate(nugetOutput) {\n\t\t\tconst nupkgPath = path.join(nugetOutput, `${this.name}.${this.version}.nupkg`);\n\t\t\tconst cmd = path.resolve(__dirname, '..', 'vendor', 'Update.com');\n\t\t\tconst args = [\n\t\t\t\t'--releasify',\n\t\t\t\tnupkgPath,\n\t\t\t\t'--releaseDir',\n\t\t\t\tthis.outputDirectory,\n\t\t\t\t'--loadingGif',\n\t\t\t\tthis.loadingGif\n\t\t\t];\n\n\t\t\tif (this.signWithParams) {\n\t\t\t\targs.push('--signWithParams');\n\t\t\t\targs.push(this.signWithParams);\n\t\t\t}\n\t\t\telse if (this.certificateFile && this.certificatePassword) {\n\t\t\t\targs.push('--signWithParams');\n\t\t\t\targs.push(`/a /f \\\"${path.resolve(this.certificateFile)}\\\" /p \\\"${this.certificatePassword}\\\"`);\n\t\t\t}\n\n\t\t\tif (this.setupIcon) {\n\t\t\t\tconst setupIconPath = path.resolve(this.setupIcon);\n\t\t\t\targs.push('--setupIcon');\n\t\t\t\targs.push(setupIconPath);\n\t\t\t}\n\n\t\t\treturn Util.exec(cmd, args);\n\t\t}\n\t\tupdateSetupFile() {\n\t\t\tif(this.productName) {\n\t\t\t\tconst setupPath = path.join(this.outputDirectory, `${this.productName}Setup.exe`);\n\t\t\t\tfs.renameSync(path.join(this.outputDirectory, 'Setup.exe'), setupPath);\n\t\t\t}\n\n\t\t\treturn bluebird.resolve();\n\t\t}\n\t\tcreateInstaller() {\n\t\t\t// Start tracking temporary directories\n\t\t\ttemp.track();\n\n\t\t\t// Bundle Update.exe with the app\n\t\t\tfs.copySync(path.resolve(__dirname, '..', 'vendor', 'Update.exe'), path.join(this.appDirectory, 'Update.exe'));\n\n\t\t\t// Read the contents of template.nuspec file\n\t\t\tconst template = dot.template(fs.readFileSync(path.resolve(__dirname, '..', 'resources', 'template.nuspec')));\n\n\t\t\t// Fill the template with provided configuration parameters\n\t\t\tconst nuspecContent = template({\n\t\t\t\tname: this.name,\n\t\t\t\ttitle: this.title,\n\t\t\t\tversion: this.version,\n\t\t\t\tauthors: this.authors,\n\t\t\t\towners: this.owners,\n\t\t\t\ticonUrl: this.iconUrl,\n\t\t\t\tdescription: this.description,\n\t\t\t\texe: this.exe\n\t\t\t});\n\n\t\t\t// Create temporary directory for the installer\n\t\t\tconst nugetOutput = temp.mkdirSync('squirrel-installer-');\n\t\t\tconst targetNuspecPath = path.join(nugetOutput, `${this.name}.nuspec`);\n\t\t\tfs.writeFileSync(targetNuspecPath, nuspecContent);\n\n\t\t\tlet cmd = path.resolve(__dirname, '..', 'vendor', 'nuget.exe');\n\t\t\tconst args = [\n\t\t\t\t'pack',\n\t\t\t\ttargetNuspecPath,\n\t\t\t\t'-BasePath',\n\t\t\t\tpath.resolve(this.appDirectory),\n\t\t\t\t'-OutputDirectory',\n\t\t\t\tnugetOutput,\n\t\t\t\t'-NoDefaultExcludes'\n\t\t\t];\n\n\t\t\tif (process.platform !== 'win32') {\n\t      args.unshift(cmd);\n\t      cmd = 'wine';\n\t\t\t}\n\n\t\t\treturn Util.exec(cmd, args)\n\t\t\t\t.then(() => this.syncReleases())\n\t\t\t\t.then(() => this.update(nugetOutput))\n\t\t\t\t.then(() => this.updateSetupFile());\n\t\t}\n\t}\n\n\tvar _InstallerFactory = InstallerFactory;\n\n\t'use strict';\n\n\tvar index = opts => {\n\t  try {\n\t    let installerFactory = new _InstallerFactory(opts);\n\t    return installerFactory.createInstaller();\n\t  } catch (error) {\n\t    return bluebird.reject(error);\n\t  }\n\t}\n\n\treturn index;\n\n}));\n"],"sourceRoot":"/source/"}