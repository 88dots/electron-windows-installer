var _createClass=function(){function e(e,t){for(var r in t){var i=t[r];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("bluebird"),require("path"),require("fs-promise"),require("temp"),require("dot"),require("child_process"),require("jsonfile"),require("asar")):"function"==typeof define&&define.amd?define(["bluebird","path","fs-promise","temp","dot","child_process","jsonfile","asar"],t):e.MyLibrary=t(e.bluebird,e.path,e.fs,e.temp,e.dot,e.ChildProcess,e.jf,e.asar)}(this,function(e,t,r,i,s,n,o,a){"use strict";var c={isEmpty:function(e){return!e||0===e.length},exec:function(t,r,i){return new e(function(e,s){n.execFile(t,r,i,function(i,n,o){i?s(new Error("Command\n"+t+" "+r+"\n returned non-zero code "+i+" with error output "+o)):e(n)})})},getPackageJson:function(e){try{return o.readFileSync(t.resolve(e,"resources","app","package.json"))}catch(r){try{return JSON.parse(a.extractFile(t.resolve(e,"resources","app.asar"),"package.json"))}catch(r){throw new Error("Neither resources/app folder nor resources/app.asar package were found.")}}}},u=function(){function n(){var e=void 0===arguments[0]?{}:arguments[0],r=e.appDirectory,i=e.outputDirectory,s=void 0===i?"installer":i,o=e.loadingGif,a=void 0===o?t.resolve(__dirname,"..","resources","install-spinner.gif"):o,u=e.authors,h=e.owners,p=e.exe,l=e.iconUrl,d=void 0===l?"https://raw.githubusercontent.com/atom/atom-shell/master/atom/browser/resources/win/atom.ico":l,f=e.description,m=e.version,v=e.title,y=e.certificateFile,w=e.certificatePassword,g=e.signWithParams,x=e.setupIcon,_=e.remoteReleases;if(_classCallCheck(this,n),c.isEmpty(r))throw new Error('Please provide "appDirectory" config parameter.');try{var P=c.getPackageJson(r);this.appDirectory=r,this.outputDirectory=t.resolve(s),this.loadingGif=t.resolve(a),this.authors=u||P.author||"",this.owners=h||this.authors,this.name=P.name,this.exe=p||this.name,this.iconUrl=d,this.description=f||P.description,this.version=m||P.version,this.productName=P.productName||this.name,this.title=v||this.productName||this.name,this.certificateFile=y,this.certificatePassword=w,this.signWithParams=g,this.setupIcon=x,this.remoteReleases=_}catch(D){throw D}}return _createClass(n,{syncReleases:{value:function(){if(this.remoteReleases){var r=t.resolve(__dirname,"..","vendor","SyncReleases.exe"),i=["-u",this.remoteReleases,"-r",this.outputDirectory];return c.exec(r,i)}return e.resolve()}},update:{value:function(e){var r=t.join(e,""+this.name+"."+this.version+".nupkg"),i=t.resolve(__dirname,"..","vendor","Update.com"),s=["--releasify",r,"--releaseDir",this.outputDirectory,"--loadingGif",this.loadingGif];if(this.signWithParams?(s.push("--signWithParams"),s.push(this.signWithParams)):this.certificateFile&&this.certificatePassword&&(s.push("--signWithParams"),s.push('/a /f "'+t.resolve(this.certificateFile)+'" /p "'+this.certificatePassword+'"')),this.setupIcon){var n=t.resolve(this.setupIcon);s.push("--setupIcon"),s.push(n)}return c.exec(i,s)}},updateSetupFile:{value:function(){if(this.productName){var i=t.join(this.outputDirectory,""+this.productName+"Setup.exe");r.renameSync(t.join(this.outputDirectory,"Setup.exe"),i)}return e.resolve()}},createInstaller:{value:function(){var e=this;i.track(),r.copySync(t.resolve(__dirname,"..","vendor","Update.exe"),t.join(this.appDirectory,"Update.exe"));var n=s.template(r.readFileSync(t.resolve(__dirname,"..","resources","template.nuspec"))),o=n({name:this.name,title:this.title,version:this.version,authors:this.authors,owners:this.owners,iconUrl:this.iconUrl,description:this.description,exe:this.exe}),a=i.mkdirSync("squirrel-installer-"),u=t.join(a,""+this.name+".nuspec");r.writeFileSync(u,o);var h=t.resolve(__dirname,"..","vendor","nuget.exe"),p=["pack",u,"-BasePath",t.resolve(this.appDirectory),"-OutputDirectory",a,"-NoDefaultExcludes"];return"win32"!==process.platform&&(p.unshift(h),h="wine"),c.exec(h,p).then(function(){return e.syncReleases()}).then(function(){return e.update(a)}).then(function(){return e.updateSetupFile()})}}}),n}(),h=u,p=function(t){try{var r=new h(t);return r.createInstaller()}catch(i){return e.reject(i)}};return p});
//# sourceMappingURL=library-dist.min.js.map